
<beans:beans xmlns="http://www.springframework.org/schema/security" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:tx="http://www.springframework.org/schema/tx"   
	 
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans 
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/tx 
        http://www.springframework.org/schema/tx/spring-tx.xsd
        http://www.springframework.org/schema/security 
        http://www.springframework.org/schema/security/spring-security.xsd">
        
    <beans:bean id="authFailureHandler" class="com.virtualpairprogrammers.security.UsernameAndPasswordFailureHandler" autowire="byType"/>    
   
    <beans:bean id="derbyDatasource" class="org.apache.commons.dbcp.BasicDataSource">
    	<beans:property name="driverClassName" value="org.apache.derby.jdbc.ClientDriver" />
    	<beans:property name="url" value="jdbc:derby://localhost/MyDB2" />
    </beans:bean>
   
    <!-- <beans:bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
    	<beans:property name="dataSource" ref="derbyDatasource" />
    </beans:bean>  
    
    <tx:annotation-driven /> -->
    <http pattern="/styles.css" security="none" />
    <http pattern="/css/**" security="none" /> <!-- To allow users to access all css resources -->
       
	<http>
	
		<csrf disabled="true" />
		<intercept-url pattern="/login.jsp" access="permitAll" />
		<intercept-url pattern="/addNewBook.do" access="hasRole('ROLE_ADMIN')" />
		<intercept-url pattern="/**" access="hasRole('ROLE_USER')" />
		<form-login login-processing-url="/performLogin" 
					username-parameter="vppUsername" 
					password-parameter="vppPassword" 
					login-page="/login.jsp" 
					authentication-failure-handler-ref="authFailureHandler"/> 
					<!-- authentication-failure-url="/login.jsp?error"/> -->
					 
					
		<logout logout-success-url="/viewAllBooks.do" />			
	</http>
	
	<authentication-manager>
		<authentication-provider>
			<jdbc-user-service data-source-ref="derbyDatasource"  
							users-by-username-query="select username,password,true from tbl_users where username=?"
							authorities-by-username-query="select username,role from tbl_roles where username=?"/>
		</authentication-provider>
	</authentication-manager>
</beans:beans>	